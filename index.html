<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NovelVerse</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
  <!-- Collapsible Header -->
  <header id="header">
    <div class="container">
      <div class="logo" id="logo">üìñ NovelVerse</div>
      <div class="nav" id="nav">
        <button id="toggleNav">‚ò∞</button>
        <div class="links">
          <a href="#" id="tab-read">Read</a>
          <a href="#" id="tab-write">Write</a>
          <a href="#" id="tab-profile">Profile</a>
        </div>
        <button id="btnAuth">Sign In</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Read Tab -->
    <div id="read-tab" class="tab-content active">
      <h2>Public Stories</h2>
      <div id="stories-list">Loading stories...</div>
    </div>

    <!-- Write Tab -->
    <div id="write-tab" class="tab-content">
      <h2>Write Your Story</h2>
      <input type="text" id="story-title" placeholder="Story Title" />
      <textarea id="story-content" placeholder="Write your chapter here..."></textarea>
      <button id="btn-save">Save Story</button>
      <div id="save-status"></div>
    </div>

    <!-- Profile Tab -->
    <div id="profile-tab" class="tab-content">
      <h2>Your Profile</h2>
      <div id="profile-info">Sign in to see your stories</div>
    </div>
  </main>

  <!-- AdSense Placeholder (for monetization) -->
  <div class="ad-container">
    <div class="ad-placeholder">Ad Space for Authors</div>
  </div>

  <script>
    
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // DOM Elements
    const header = document.getElementById('header');
    const logo = document.getElementById('logo');
    const nav = document.getElementById('nav');
    const toggleNav = document.getElementById('toggleNav');
    const btnAuth = document.getElementById('btnAuth');
    const tabRead = document.getElementById('tab-read');
    const tabWrite = document.getElementById('tab-write');
    const tabProfile = document.getElementById('tab-profile');
    const readTab = document.getElementById('read-tab');
    const writeTab = document.getElementById('write-tab');
    const profileTab = document.getElementById('profile-tab');
    const storiesList = document.getElementById('stories-list');
    const storyTitle = document.getElementById('story-title');
    const storyContent = document.getElementById('story-content');
    const btnSave = document.getElementById('btn-save');
    const saveStatus = document.getElementById('save-status');
    const profileInfo = document.getElementById('profile-info');

    // State
    let currentUser = null;

    // Toggle mobile nav
    toggleNav.addEventListener('click', () => {
      nav.classList.toggle('mobile-open');
    });

    // Collapse header on logo click
    logo.addEventListener('click', () => {
      header.classList.toggle('collapsed');
    });

    // Tab switching
    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav a').forEach(el => el.classList.remove('active'));
      
      if (tabName === 'read') {
        readTab.classList.add('active');
        tabRead.classList.add('active');
        loadPublicStories();
      } else if (tabName === 'write') {
        writeTab.classList.add('active');
        tabWrite.classList.add('active');
      } else if (tabName === 'profile') {
        profileTab.classList.add('active');
        tabProfile.classList.add('active');
        loadUserProfile();
      }
    }

    tabRead.addEventListener('click', (e) => { e.preventDefault(); showTab('read'); });
    tabWrite.addEventListener('click', (e) => { e.preventDefault(); showTab('write'); });
    tabProfile.addEventListener('click', (e) => { e.preventDefault(); showTab('profile'); });

    // Auth
    btnAuth.addEventListener('click', () => {
      if (currentUser) {
        auth.signOut();
      } else {
        const email = prompt("Enter your email:");
        const password = prompt("Enter a password (min 6 chars):");
        if (email && password) {
          auth.createUserWithEmailAndPassword(email, password)
            .catch(error => alert("Error: " + error.message));
        }
      }
    });

    auth.onAuthStateChanged(user => {
      currentUser = user;
      if (user) {
        btnAuth.textContent = "Sign Out";
        showTab('profile');
      } else {
        btnAuth.textContent = "Sign In";
        showTab('read');
      }
    });

    // Load public stories
    function loadPublicStories() {
      storiesList.innerHTML = "Loading...";
      db.collection("stories")
        .where("isPublic", "==", true)
        .orderBy("createdAt", "desc")
        .limit(10)
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            storiesList.innerHTML = "<p>No stories yet. Be the first to write one!</p>";
            return;
          }
          let html = "";
          snapshot.forEach(doc => {
            const story = doc.data();
            html += `
              <div class="story-card">
                <h3>${story.title}</h3>
                <p>${story.content.substring(0, 150)}...</p>
                <small>By: ${story.authorEmail}</small>
              </div>
            `;
          });
          storiesList.innerHTML = html;
        })
        .catch(err => {
          storiesList.innerHTML = `<p>Error loading stories: ${err.message}</p>`;
        });
    }

    // Save story
    btnSave.addEventListener('click', () => {
      if (!currentUser) {
        alert("Please sign in first!");
        return;
      }
      const title = storyTitle.value.trim();
      const content = storyContent.value.trim();
      if (!title || !content) {
        saveStatus.textContent = "Please fill in both title and content.";
        return;
      }
      saveStatus.textContent = "Saving...";
      db.collection("stories").add({
        title: title,
        content: content,
        authorEmail: currentUser.email,
        isPublic: true,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        saveStatus.textContent = "‚úÖ Story saved!";
        storyTitle.value = "";
        storyContent.value = "";
        setTimeout(() => showTab('read'), 1500);
      })
      .catch(err => {
        saveStatus.textContent = "‚ùå Error: " + err.message;
      });
    });

    // Load user profile
    function loadUserProfile() {
      if (!currentUser) {
        profileInfo.innerHTML = "<p>Please sign in to see your profile.</p>";
        return;
      }
      profileInfo.innerHTML = `
        <p><strong>Email:</strong> ${currentUser.email}</p>
        <p><strong>Your Stories:</strong></p>
        <div id="user-stories">Loading...</div>
      `;
      db.collection("stories")
        .where("authorEmail", "==", currentUser.email)
        .orderBy("createdAt", "desc")
        .get()
        .then(snapshot => {
          const userStories = document.getElementById('user-stories');
          if (snapshot.empty) {
            userStories.innerHTML = "<p>You haven't written any stories yet.</p>";
            return;
          }
          let html = "<ul>";
          snapshot.forEach(doc => {
            const story = doc.data();
            html += `<li>${story.title} (${story.content.substring(0, 30)}...)</li>`;
          });
          html += "</ul>";
          userStories.innerHTML = html;
        });
    }

    // Init
    showTab('read');
  </script>
</body>
</html>